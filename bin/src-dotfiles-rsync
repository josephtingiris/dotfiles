#!/bin/bash

dotfiles_rsync=$(which rsync 2> /dev/null)
if [ ! -x $dotfiles_srync ]; then
    echo "can't find executable rsync"
    exit 1
fi

dotfiles_to=""
if [ "$1" != "" ]; then
    dotfiles_to="${1}:"
fi

dotfiles_src="$(dirname $(readlink -e . 2> /dev/null | grep \/src\/dotfiles\/) 2> /dev/null)"
if [ "$dotfiles_src" == "" ]; then
    dotfiles_src="$(readlink -e . 2> /dev/null | grep \/src\/dotfiles)"
fi
if [ "$dotfiles_src" != "" ] && [ -d "$dotfiles_src" ]; then
    rsync_args="-avp"
    rsync ${rsync_args} ${dotfiles_src}/ ${dotfiles_to}${HOME}/
    rsync ${rsync_args} --delete-after ${dotfiles_src}/.git/ ${dotfiles_to}${HOME}/.git/
else
    echo "this only works for/from src/dotfiles"
fi
